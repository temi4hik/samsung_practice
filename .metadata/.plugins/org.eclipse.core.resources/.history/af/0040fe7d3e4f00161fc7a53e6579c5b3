var documentsDir;

function writeMessage() {
	
	var messageFile = null;
	var senderName = $('#sender-name').val();
	var messageText = $('#message-text').val();
	
	tizen.filesystem.resolve(
		     'documents',
		     function(dir) {
		       documentsDir = dir; 
		       dir.listFiles(function(files) {
		    	   
		    	   var fileName = getMsgFileName();
		    	   
		    	   
		    	   for (var i = 0; i < files.length; ++i) {
		    		   if (files[i].name == fileName) {
		    			   messageFile = files[i];
		    			   break;
		    		   }
		    	   }
		    	   
		    	   if (messageFile == null) {
		    		   messageFile = documentsDir.createFile(fileName);
		    	   }
		    	   
		    	   
		    	   var textToWrite = "time: " + "sometime" + "\n" + 
		    	   					 "sender: " + senderName + "\n" + 
		    	   					 "text: " + messageText + "\n";
		    	   
		    	   //writeLogToFile(logFile, getNow() + ": " + logText);
		    	   
		       },null);
		     }, function(e) {
		       console.log("Error" + e.message);
		     }, "rw"
		 ); 
}


function getMsgFileName() {
	
	var today = new Date();
	var dd = today.getDate();
	var mm = today.getMonth();
	var yyyy = today.getFullYear();
	
	dd = dd >= 10 ? dd : '0' + dd;
	mm = mm >= 10 ? mm : '0' + mm;
	
	return 'mes' + '-' + dd + '-' + mm + '-' + yyyy;
}

function writeLogToFile(file, text) {
	alert(text);
	file.openStream(
			"a",
			function(fs) {
				fs.write(text + '\n');
				fs.close();
			}, function(e) {
				console.log("Error" + e.message);
			},
			"UTF-8"
		);
}